# Sourced from shell startup files, e.g. `.zshrc`, `.zshenv`, `.bashrc`.

_call_start_env() {
  _call_start_scripts_phase env
}

_call_start_rc() {
  _call_start_scripts_phase rc
  _call_start_scripts_phase post_rc
}

_call_start_scripts_phase() {
  local init_phase="$1"
  _determine_shell_type
  for initfile in "$HOME/.dotfiles/scripts/"*; do
    base_name=$(basename "${initfile}")
    if [[ "${base_name}" != "README.md" ]]; then
      source "$initfile"
      _init_function_if_exists "init_${init_phase}"
      _init_function_if_exists "init_${init_phase}_${shell_type}"
      unset -f init_env init_env_other init_env_zsh init_rc init_rc_other init_rc_zsh init_post_rc init_post_rc_other init_post_rc_zsh 2>/dev/null
    fi
  done
}

_determine_shell_type() {
  if [[ -n "$ZSH_VERSION" ]]; then
    shell_type="zsh"
  else
    shell_type="other"
  fi
}

_function_exists() {
  declare -f -F $1 > /dev/null
  return $?
}

_init_function_if_exists() {
  local function_name="$1"
  if _function_exists "$function_name"; then
    "$function_name"
  fi
}

_shell_start_teardown() {
  unset -f _call_start_env _call_start_rc _call_start_scripts_phase _determine_shell_type _function_exists _init_function_if_exists _shell_start_teardown
  unset shell_type
}
